<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>首页</title>
    <link rel="stylesheet" href="../css/weui-min.css" />
    <link rel="stylesheet" href="../css/example.css" />
    <script src="https://cdn.bootcss.com/vue/2.5.17-beta.0/vue.min.js"></script>
    <link rel="stylesheet" href="../css/spin.css" />
    <style>
        #modal-overlay {
             position: absolute;   /* 使用绝对定位或固定定位  */
             left: 0px;    
             top: 0px;
             width:100%;
             height:100%;
             text-align:center;
             z-index: 1000;
             background-color: #fff;
        }
        /* 模态框样式 */
        .modal-data{
             margin: 80% auto;
             padding:15px;
             text-align:center;
             opacity: 0.5;
        }
    </style>
</head>

<body style="background-color: #f2f2f2">
    <div class="weui-flex" style="justify-content: center;align-items: center;height: 20%;background-image: url(../src/background.png);border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;"
        id='name'>
        <div style="position: fixed;height: 30px;right: 0;top: 0;background-color: #9999ff;text-align: center;border-bottom-left-radius: 15px;border-top-left-radius: 15px;padding-left: 5px"
            v-text="shop"></div>
        <div class="box weui-flex" style="flex: 0 0 100%;width: 100%; border-radius: 5px;align-items: center">
            <img onclick="navi('space.html')" :src="head" style="width: 64px;height: 64px;margin-left: 10px;border-radius:50%">
            <div class="item weui-flex__item" style="margin-left: 10px">
                <h3 style="color: white;font-size: 17px;font-weight: 400" v-text="name"></h3>
                <h1 style="color: white;font-size: 15px;font-weight: 400" v-text="id"></h1>
            </div>
        </div>
    </div>
    <div style="height: 30%;text-align: center;background-color: white;width: 96%;margin-left: 2%;border-radius: 5px;margin-top: 10px">
        <h1 style="color: gray;font-size: 15px;font-weight: 400;margin-top: 10px">最近提成趋势图（元）</h1>
        <div id="container" style="height: 190px"></div>
    </div>
    <div class="" style="height: 26%;background-color: white;width: 96%;margin-left: 2%;border-radius: 5px;margin-top: 10px">
        <div class="weui-flex" style="height: 50%;align-items: center;border-bottom: 1px #f2f2f2 solid" id='salary'>
            <div class="weui-flex__item" style="margin-left: 20px">
                <h3 style="color: gray;font-size: 15px;font-weight: 400">今日提成（元）</h3>
                <h1 style="color: #404040;font-size: 15px" v-text="todaysalary"></h1>
            </div>
            <div class="weui-flex__item" style="margin-left: 20px">
                <h3 style="color: gray;font-size: 15px;font-weight: 400">本月总提成（元）</h3>
                <h1 style="color: #404040;font-size: 15px" v-text="salary"></h1>
            </div>
        </div>
        <div class="weui-flex" style="height: 50%;align-items: center;" id='clock'>
            <div class="weui-flex__item" style="margin-left: 20px">
                <h3 style="color: gray;font-size: 15px;font-weight: 400">今日点钟（次）</h3>
                <h1 style="color: #404040;font-size: 15px" v-text="todayclock"></h1>
            </div>
            <div class="weui-flex__item" style="margin-left: 20px">
                <h3 style="color: gray;font-size: 15px;font-weight: 400">本月总钟数（次）</h3>
                <h1 style="color: #404040;font-size: 15px" v-text="clock"></h1>
            </div>
        </div>
    </div>
    <div class="" style="height: 13%;background-color: white;width: 96%;margin-left: 2%;border-radius: 5px;margin-top: 10px">
        <div class="weui-flex" style="height: 100%;align-items: center;border-bottom: 1px #f2f2f2 solid">
            <div class="weui-flex__item" style="margin-left: 10px;background-image: url(../src/业绩汇总.png);background-repeat: no-repeat;border-right: 1px solid #f2f2f2;cursor: pointer;"
                onclick="navi('overview.html')">
                <h3 style="color: black;font-size: 10px;font-weight: 400;margin-left: 50px">业绩汇总</h3>
                <h1 style="color: grey;font-size: 5px;margin-left: 50px;margin-top: 6px">数据分析总结</h1>
            </div>
            <div class="weui-flex__item" style="margin-left: 10px;background-image: url(../src/明细.png);background-repeat: no-repeat;border-right: 1px solid #f2f2f2;cursor: pointer"
                onclick="navi('clock.html')">
                <h3 style="color: black;font-size: 10px;font-weight: 400;margin-left: 50px">业绩明细</h3>
                <h1 style="color: grey;font-size: 5px;margin-left: 50px;margin-top: 6px">查询每条明细</h1>
            </div>
        </div>
    </div>
    <div class="weui-footer" style="margin-top: 20px">
        <p class="weui-footer__text">查帐方式以结账时间为准</p>
    </div>
    <div id="modal-overlay">
        <div class="modal-data">
                <img src="../src/loading.gif" />
        </div>
    </div>
</body>
<script type="text/javascript" src="../js/jweixin.js"></script>
<script type="text/javascript" src="../js/weui-min.js"></script>
<script type="text/javascript" src="../js/zepto.js"></script>
<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" src="../js/echarts-simple-min.js"></script>
<script type="text/javascript" src="../js/sweetalert2.all.js"></script>
<script type="text/javascript">
    var id = 'r6s1'

    overlay();
    id = getQueryString("id");
    //我也不知道为什么，反正这里一定要post才能正常
    $.post('../php/empty.php').done((result) => {
        id = id;
        var back = {}
        $.ajax({
            type: 'POST',
            async: false,
            data: {
                id: id
            },
            dataType: 'json',
            url: '../php/getmainpage.php',
        }).done((data) => {
            if (data.status == 1) {
                back = data.data
            }
        })
        if (back.chart.status == 1) {
            myChart.setOption(back.chart.data)
        }
        var app1 = new Vue({
            el: '#name',
            data: {
                name: '',
                id: '',
                shop: '',
                head: ''
            },
            methods: {},
            created() {
                var that = this;
                data = back.app1
                if (data.status == 1) {
                    that.name = data.name
                    that.id = id
                    that.shop = data.shop
                }
                $.post("../php/gettechdetail.php", {
                    job_number: id
                }).done((result) => {
                    result = JSON.parse(result);
                    if (result.status == 1) {
                        that.head = result.data[0].photo
                        overlay(false);
                    }
                })
            },
        })
        var app2 = new Vue({
            el: '#salary',
            data: {
                todaysalary: '',
                salary: ''
            },
            created() {
                var that = this;
                data = back.app2
                if (data.status == 1) {
                    that.salary = data.salary
                    that.todaysalary = data.todaysalary
                }

            }
        })
        var app3 = new Vue({
            el: '#clock',
            data: {
                todayclock: '',
                clock: ''
            },
            created() {
                var that = this;
                data = back.app3
                if (data.status == 1) {
                    that.clock = data.clock
                    that.todayclock = data.todayclock
                }


            }
        })
    })




    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    function navi(url) {
        window.location.href = url + "?id=" + id;
    }

    var dom = document.getElementById("container");
    var myChart = echarts.init(dom);
    var app = {};
    option = null;
    option = {
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: []
        },
        yAxis: {
            type: 'value',
            show: false,
        },
        itemStyle: {
            color: '#cc99cc',
            shadowBlur: 200,
            shadowColor: 'rgba(0, 0, 0, 0.5)',
        },
        animation: false,
        series: [{
            data: [],
            type: 'line',
            areaStyle: {},
            itemStyle: {
                normal: {
                    label: {
                        show: true
                    }
                }
            }
        }],
    };;
    if (option && typeof option === "object") {
        myChart.setOption(option, true);
    }

    function overlay(state = true) {
        var e1 = document.getElementById('modal-overlay');
        if (state) e1.style.visibility = "visible"
        else e1.style.visibility = "hidden"
    }
</script>

</html>